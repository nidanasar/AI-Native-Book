"use strict";(globalThis.webpackChunkhackathon_text_book=globalThis.webpackChunkhackathon_text_book||[]).push([[8072],{2946:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>l,metadata:()=>s,toc:()=>a});const s=JSON.parse('{"id":"module-1-ros2/python-rclpy-bridge","title":"Chapter 3: Bridging Python Agents to ROS 2 Controllers","description":"Write Python code using rclpy to control robot nodes","source":"@site/docs/module-1-ros2/03-python-rclpy-bridge.md","sourceDirName":"module-1-ros2","slug":"/module-1-ros2/python-rclpy-bridge","permalink":"/docs/module-1-ros2/python-rclpy-bridge","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/module-1-ros2/03-python-rclpy-bridge.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3,"title":"Chapter 3: Bridging Python Agents to ROS 2 Controllers","description":"Write Python code using rclpy to control robot nodes"},"sidebar":"tutorialSidebar","previous":{"title":"Chapter 2: Nodes, Topics, and Services","permalink":"/docs/module-1-ros2/nodes-topics-services"},"next":{"title":"Chapter 4: Understanding URDF for Humanoid Robots","permalink":"/docs/module-1-ros2/urdf-humanoid-robots"}}');var i=r(4848),t=r(8453);const l={sidebar_position:3,title:"Chapter 3: Bridging Python Agents to ROS 2 Controllers",description:"Write Python code using rclpy to control robot nodes"},o="Bridging Python Agents to ROS 2 Controllers",c={},a=[{value:"Introduction to rclpy",id:"introduction-to-rclpy",level:2},{value:"What is rclpy?",id:"what-is-rclpy",level:3},{value:"Why Python for ROS 2?",id:"why-python-for-ros-2",level:3},{value:"The rclpy Architecture",id:"the-rclpy-architecture",level:3},{value:"Creating Your First Node",id:"creating-your-first-node",level:2},{value:"The Node Class",id:"the-node-class",level:3},{value:"Essential Node Methods",id:"essential-node-methods",level:3},{value:"Logging",id:"logging",level:3},{value:"The Complete Node Template",id:"the-complete-node-template",level:3},{value:"Publishing and Subscribing to Topics",id:"publishing-and-subscribing-to-topics",level:2},{value:"Creating a Publisher",id:"creating-a-publisher",level:3},{value:"Creating a Subscriber",id:"creating-a-subscriber",level:3},{value:"Running Publisher and Subscriber Together",id:"running-publisher-and-subscriber-together",level:3},{value:"Message Types",id:"message-types",level:3},{value:"Working with Services",id:"working-with-services",level:2},{value:"Creating a Service Server",id:"creating-a-service-server",level:3},{value:"Creating a Service Client",id:"creating-a-service-client",level:3},{value:"Running Server and Client Together",id:"running-server-and-client-together",level:3},{value:"Complete Working Example",id:"complete-working-example",level:2},{value:"System Architecture",id:"system-architecture",level:3},{value:"Integrated Node Example",id:"integrated-node-example",level:3},{value:"Testing the Integrated System",id:"testing-the-integrated-system",level:3},{value:"Summary",id:"summary",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"bridging-python-agents-to-ros-2-controllers",children:"Bridging Python Agents to ROS 2 Controllers"})}),"\n",(0,i.jsxs)(n.admonition,{title:"Learning Objectives",type:"info",children:[(0,i.jsx)(n.p,{children:"By the end of this chapter, you will be able to:"}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Set up a Python environment for ROS 2 development with rclpy"}),"\n",(0,i.jsx)(n.li,{children:"Create a basic ROS 2 node in Python"}),"\n",(0,i.jsx)(n.li,{children:"Publish and subscribe to topics using rclpy"}),"\n",(0,i.jsx)(n.li,{children:"Call and provide services in Python"}),"\n"]})]}),"\n",(0,i.jsx)(n.h2,{id:"introduction-to-rclpy",children:"Introduction to rclpy"}),"\n",(0,i.jsxs)(n.p,{children:["In the previous chapters, you learned how ROS 2 organizes robot systems into nodes that communicate through topics and services. Now it's time to write actual code. ",(0,i.jsx)(n.strong,{children:"rclpy"})," (ROS Client Library for Python) is your gateway to creating ROS 2 applications in Python."]}),"\n",(0,i.jsx)(n.h3,{id:"what-is-rclpy",children:"What is rclpy?"}),"\n",(0,i.jsx)(n.p,{children:"rclpy is the official Python client library for ROS 2. It provides Python bindings to the underlying ROS 2 core libraries, letting you:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Create and manage nodes"}),"\n",(0,i.jsx)(n.li,{children:"Publish and subscribe to topics"}),"\n",(0,i.jsx)(n.li,{children:"Provide and call services"}),"\n",(0,i.jsx)(n.li,{children:"Work with parameters and timers"}),"\n",(0,i.jsx)(n.li,{children:"Handle the node lifecycle"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:'Think of rclpy as the "nerve endings" that connect your Python code to the ROS 2 nervous system. Just as neurons have specialized receptors and transmitters, rclpy provides the interfaces your code needs to send and receive signals.'}),"\n",(0,i.jsx)(n.h3,{id:"why-python-for-ros-2",children:"Why Python for ROS 2?"}),"\n",(0,i.jsx)(n.p,{children:"ROS 2 supports multiple programming languages, with C++ and Python being the most common. Python offers several advantages for learning and rapid development:"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Advantage"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Readability"})}),(0,i.jsx)(n.td,{children:"Python's clean syntax makes code easier to understand"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Rapid prototyping"})}),(0,i.jsx)(n.td,{children:"No compilation step means faster iteration"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Rich ecosystem"})}),(0,i.jsx)(n.td,{children:"Easy integration with NumPy, OpenCV, PyTorch, etc."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Debugging"})}),(0,i.jsx)(n.td,{children:"Interactive development and easier troubleshooting"})]})]})]}),"\n",(0,i.jsx)(n.p,{children:"For production robots requiring maximum performance, C++ (rclcpp) is often preferred. However, many successful robots use Python for high-level logic while delegating time-critical operations to lower-level components. This hybrid approach is common in humanoid robotics."}),"\n",(0,i.jsx)(n.h3,{id:"the-rclpy-architecture",children:"The rclpy Architecture"}),"\n",(0,i.jsx)(n.p,{children:"Every rclpy program follows a consistent pattern:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"import rclpy\r\nfrom rclpy.node import Node\r\n\r\n# 1. Initialize the ROS 2 Python library\r\nrclpy.init()\r\n\r\n# 2. Create your node(s)\r\nnode = Node('my_node_name')\r\n\r\n# 3. Do work (spin, process callbacks)\r\nrclpy.spin(node)\r\n\r\n# 4. Clean up\r\nnode.destroy_node()\r\nrclpy.shutdown()\n"})}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"rclpy.init()"})," call is essential\u2014it connects your Python process to the ROS 2 middleware. Without it, nothing works. The ",(0,i.jsx)(n.code,{children:"rclpy.spin()"})," function keeps your node alive, processing incoming messages and timer callbacks. When you're done, proper cleanup with ",(0,i.jsx)(n.code,{children:"destroy_node()"})," and ",(0,i.jsx)(n.code,{children:"shutdown()"})," releases resources cleanly."]}),"\n",(0,i.jsx)(n.admonition,{title:"Nervous System Parallel",type:"tip",children:(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"rclpy.init()"})," is like waking up\u2014it activates your connection to the nervous system. ",(0,i.jsx)(n.code,{children:"rclpy.spin()"})," is like staying conscious\u2014continuously processing sensory input and generating responses."]})}),"\n",(0,i.jsx)(n.h2,{id:"creating-your-first-node",children:"Creating Your First Node"}),"\n",(0,i.jsx)(n.p,{children:"Let's build a simple ROS 2 node step by step. Understanding this foundation will make everything else easier."}),"\n",(0,i.jsx)(n.h3,{id:"the-node-class",children:"The Node Class"}),"\n",(0,i.jsxs)(n.p,{children:["In rclpy, you typically create nodes by subclassing ",(0,i.jsx)(n.code,{children:"Node"}),". This object-oriented approach keeps your code organized and provides access to all ROS 2 functionality:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"import rclpy\r\nfrom rclpy.node import Node\r\n\r\nclass MyFirstNode(Node):\r\n    def __init__(self):\r\n        # Initialize with a unique node name\r\n        super().__init__('my_first_node')\r\n\r\n        # Log a message to confirm we're running\r\n        self.get_logger().info('Node has started!')\n"})}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"super().__init__('my_first_node')"})," call registers your node with ROS 2 using the name ",(0,i.jsx)(n.code,{children:"my_first_node"}),". This name must be unique within your robot system\u2014just like each neuron has a distinct identity within the nervous system."]}),"\n",(0,i.jsx)(n.h3,{id:"essential-node-methods",children:"Essential Node Methods"}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"Node"})," base class provides many useful methods:"]}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Method"}),(0,i.jsx)(n.th,{children:"Purpose"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"get_logger()"})}),(0,i.jsx)(n.td,{children:"Access the node's logger for output"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"create_publisher()"})}),(0,i.jsx)(n.td,{children:"Create a topic publisher"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"create_subscription()"})}),(0,i.jsx)(n.td,{children:"Create a topic subscriber"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"create_service()"})}),(0,i.jsx)(n.td,{children:"Create a service server"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"create_client()"})}),(0,i.jsx)(n.td,{children:"Create a service client"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"create_timer()"})}),(0,i.jsx)(n.td,{children:"Create a periodic timer"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"get_clock()"})}),(0,i.jsx)(n.td,{children:"Access the node's clock"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"get_name()"})}),(0,i.jsx)(n.td,{children:"Get the node's name"})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"logging",children:"Logging"}),"\n",(0,i.jsxs)(n.p,{children:["ROS 2 provides a structured logging system that's much better than ",(0,i.jsx)(n.code,{children:"print()"})," statements:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"# Different log levels for different situations\r\nself.get_logger().debug('Detailed debugging info')    # For development\r\nself.get_logger().info('Normal operation messages')   # Standard output\r\nself.get_logger().warn('Something unexpected')        # Potential issues\r\nself.get_logger().error('Something went wrong')       # Errors\r\nself.get_logger().fatal('Critical failure')          # System failures\n"})}),"\n",(0,i.jsx)(n.p,{children:"These log messages are timestamped, tagged with your node name, and can be filtered by severity level\u2014essential for debugging complex robot systems."}),"\n",(0,i.jsx)(n.h3,{id:"the-complete-node-template",children:"The Complete Node Template"}),"\n",(0,i.jsx)(n.p,{children:"Here's a reusable template for creating ROS 2 nodes:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"#!/usr/bin/env python3\r\nimport rclpy\r\nfrom rclpy.node import Node\r\n\r\nclass MyNode(Node):\r\n    def __init__(self):\r\n        super().__init__('my_node')\r\n        self.get_logger().info('Node initialized')\r\n\r\n        # Add publishers, subscribers, services, timers here\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    node = MyNode()\r\n\r\n    try:\r\n        rclpy.spin(node)\r\n    except KeyboardInterrupt:\r\n        pass\r\n    finally:\r\n        node.destroy_node()\r\n        rclpy.shutdown()\r\n\r\nif __name__ == '__main__':\r\n    main()\n"})}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"try/except/finally"})," block ensures clean shutdown even when you press Ctrl+C to stop the node. This pattern should become muscle memory."]}),"\n",(0,i.jsx)(n.admonition,{title:"Common Mistake",type:"warning",children:(0,i.jsxs)(n.p,{children:["Forgetting to call ",(0,i.jsx)(n.code,{children:"rclpy.init()"})," before creating nodes is a frequent error. You'll get cryptic error messages about uninitialized contexts. Always initialize first!"]})}),"\n",(0,i.jsx)(n.h2,{id:"publishing-and-subscribing-to-topics",children:"Publishing and Subscribing to Topics"}),"\n",(0,i.jsx)(n.p,{children:"Topics are the backbone of ROS 2 communication. Let's implement a publisher and subscriber that work together."}),"\n",(0,i.jsx)(n.h3,{id:"creating-a-publisher",children:"Creating a Publisher"}),"\n",(0,i.jsx)(n.p,{children:"A publisher sends messages to a topic at regular intervals. Here's our minimal publisher example:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'#!/usr/bin/env python3\r\n"""\r\nMinimal ROS 2 Publisher Example\r\n================================\r\nThis node publishes status messages to demonstrate the publish/subscribe pattern.\r\nThink of it as a sensory neuron continuously sending signals.\r\n"""\r\n\r\nimport rclpy\r\nfrom rclpy.node import Node\r\nfrom std_msgs.msg import String\r\n\r\n\r\nclass MinimalPublisher(Node):\r\n    """\r\n    A minimal ROS 2 publisher node.\r\n\r\n    Publishes string messages to \'robot_status\' topic every 0.5 seconds.\r\n    """\r\n\r\n    def __init__(self):\r\n        super().__init__(\'minimal_publisher\')\r\n\r\n        # Create a publisher\r\n        # Parameters: message type, topic name, queue size\r\n        self.publisher_ = self.create_publisher(\r\n            String,           # Message type\r\n            \'robot_status\',   # Topic name\r\n            10                # QoS queue depth\r\n        )\r\n\r\n        # Create a timer that fires every 0.5 seconds\r\n        timer_period = 0.5  # seconds\r\n        self.timer = self.create_timer(timer_period, self.timer_callback)\r\n\r\n        # Counter to track published messages\r\n        self.count = 0\r\n        self.get_logger().info(\'MinimalPublisher node initialized\')\r\n\r\n    def timer_callback(self):\r\n        """Called every 0.5 seconds to publish a message."""\r\n        msg = String()\r\n        msg.data = f\'Robot status update #{self.count}: All systems operational\'\r\n\r\n        self.publisher_.publish(msg)\r\n        self.get_logger().info(f\'Publishing: "{msg.data}"\')\r\n\r\n        self.count += 1\r\n\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    minimal_publisher = MinimalPublisher()\r\n\r\n    try:\r\n        rclpy.spin(minimal_publisher)\r\n    except KeyboardInterrupt:\r\n        minimal_publisher.get_logger().info(\'Shutting down...\')\r\n    finally:\r\n        minimal_publisher.destroy_node()\r\n        rclpy.shutdown()\r\n\r\n\r\nif __name__ == \'__main__\':\r\n    main()\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Key points:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"create_publisher()"})})," takes three arguments:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Message type (",(0,i.jsx)(n.code,{children:"String"})," from ",(0,i.jsx)(n.code,{children:"std_msgs.msg"}),")"]}),"\n",(0,i.jsxs)(n.li,{children:["Topic name (",(0,i.jsx)(n.code,{children:"'robot_status'"}),")"]}),"\n",(0,i.jsxs)(n.li,{children:["Queue size (",(0,i.jsx)(n.code,{children:"10"})," messages)"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"create_timer()"})})," sets up periodic execution\u2014the callback runs every 0.5 seconds"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"publish()"})})," sends the message to all subscribers"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"creating-a-subscriber",children:"Creating a Subscriber"}),"\n",(0,i.jsx)(n.p,{children:"A subscriber listens for messages on a topic. Here's the corresponding subscriber:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'#!/usr/bin/env python3\r\n"""\r\nMinimal ROS 2 Subscriber Example\r\n=================================\r\nThis node receives messages from the \'robot_status\' topic.\r\nThink of it as a motor neuron receiving commands.\r\n"""\r\n\r\nimport rclpy\r\nfrom rclpy.node import Node\r\nfrom std_msgs.msg import String\r\n\r\n\r\nclass MinimalSubscriber(Node):\r\n    """\r\n    A minimal ROS 2 subscriber node.\r\n\r\n    Listens to \'robot_status\' topic and logs received messages.\r\n    """\r\n\r\n    def __init__(self):\r\n        super().__init__(\'minimal_subscriber\')\r\n\r\n        # Create a subscription\r\n        self.subscription = self.create_subscription(\r\n            String,                    # Message type\r\n            \'robot_status\',            # Topic name\r\n            self.listener_callback,    # Callback function\r\n            10                         # QoS queue depth\r\n        )\r\n\r\n        self.get_logger().info(\'MinimalSubscriber node initialized\')\r\n        self.get_logger().info(\'Listening for messages on "robot_status" topic...\')\r\n\r\n    def listener_callback(self, msg):\r\n        """Called whenever a message is received."""\r\n        self.get_logger().info(f\'Received: "{msg.data}"\')\r\n\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    minimal_subscriber = MinimalSubscriber()\r\n\r\n    try:\r\n        rclpy.spin(minimal_subscriber)\r\n    except KeyboardInterrupt:\r\n        minimal_subscriber.get_logger().info(\'Shutting down...\')\r\n    finally:\r\n        minimal_subscriber.destroy_node()\r\n        rclpy.shutdown()\r\n\r\n\r\nif __name__ == \'__main__\':\r\n    main()\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Key points:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"create_subscription()"})})," takes four arguments:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Message type (must match publisher)"}),"\n",(0,i.jsx)(n.li,{children:"Topic name (must match publisher)"}),"\n",(0,i.jsx)(n.li,{children:"Callback function (called for each message)"}),"\n",(0,i.jsx)(n.li,{children:"Queue size"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Callback function"})," receives the message as its only argument"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"The subscriber automatically receives messages\u2014no polling required"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"running-publisher-and-subscriber-together",children:"Running Publisher and Subscriber Together"}),"\n",(0,i.jsx)(n.p,{children:"To see pub/sub in action, open two terminals:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Terminal 1: Start the publisher\r\npython3 minimal_publisher.py\r\n\r\n# Terminal 2: Start the subscriber\r\npython3 minimal_subscriber.py\n"})}),"\n",(0,i.jsx)(n.p,{children:"You'll see the subscriber receiving messages from the publisher. This decoupled communication is the essence of ROS 2\u2014neither node knows about the other; they only know about the topic."}),"\n",(0,i.jsx)(n.h3,{id:"message-types",children:"Message Types"}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"String"})," message is simple, but ROS 2 provides many message types:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"from std_msgs.msg import Int32, Float64, Bool\r\nfrom geometry_msgs.msg import Twist, Pose, Point\r\nfrom sensor_msgs.msg import Image, LaserScan, JointState\n"})}),"\n",(0,i.jsxs)(n.p,{children:["For humanoid robots, ",(0,i.jsx)(n.code,{children:"JointState"})," is particularly important\u2014it contains joint positions, velocities, and efforts for the entire robot."]}),"\n",(0,i.jsx)(n.h2,{id:"working-with-services",children:"Working with Services"}),"\n",(0,i.jsx)(n.p,{children:"Services provide request/response communication for operations that need confirmation. Let's implement a service server and client."}),"\n",(0,i.jsx)(n.h3,{id:"creating-a-service-server",children:"Creating a Service Server"}),"\n",(0,i.jsx)(n.p,{children:"A service server waits for requests and sends responses:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"#!/usr/bin/env python3\r\n\"\"\"\r\nSimple ROS 2 Service Server Example\r\n=====================================\r\nThis node provides a service that performs calculations.\r\nThink of it as a reflex arc waiting for stimuli.\r\n\"\"\"\r\n\r\nimport rclpy\r\nfrom rclpy.node import Node\r\nfrom example_interfaces.srv import AddTwoInts\r\n\r\n\r\nclass SimpleService(Node):\r\n    \"\"\"\r\n    A simple ROS 2 service server node.\r\n\r\n    Provides 'calculate_joint_position' service that adds two integers.\r\n    \"\"\"\r\n\r\n    def __init__(self):\r\n        super().__init__('simple_service')\r\n\r\n        # Create a service\r\n        self.srv = self.create_service(\r\n            AddTwoInts,                    # Service type\r\n            'calculate_joint_position',    # Service name\r\n            self.calculate_callback        # Callback function\r\n        )\r\n\r\n        self.get_logger().info('SimpleService node initialized')\r\n        self.get_logger().info('Service \"calculate_joint_position\" is ready')\r\n\r\n    def calculate_callback(self, request, response):\r\n        \"\"\"\r\n        Handle incoming service requests.\r\n\r\n        Args:\r\n            request: Contains 'a' and 'b' integers\r\n            response: Must fill 'sum' and return it\r\n        \"\"\"\r\n        response.sum = request.a + request.b\r\n\r\n        self.get_logger().info(\r\n            f'Request received: {request.a} + {request.b} = {response.sum}'\r\n        )\r\n\r\n        # IMPORTANT: Services must return the response\r\n        return response\r\n\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    simple_service = SimpleService()\r\n\r\n    try:\r\n        rclpy.spin(simple_service)\r\n    except KeyboardInterrupt:\r\n        simple_service.get_logger().info('Shutting down...')\r\n    finally:\r\n        simple_service.destroy_node()\r\n        rclpy.shutdown()\r\n\r\n\r\nif __name__ == '__main__':\r\n    main()\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Key points:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"create_service()"})})," takes service type, name, and callback"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Callback signature"})," is ",(0,i.jsx)(n.code,{children:"callback(request, response)"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Must return"})," the response object\u2014forgetting this is a common bug"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"creating-a-service-client",children:"Creating a Service Client"}),"\n",(0,i.jsx)(n.p,{children:"A service client sends requests and waits for responses:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"#!/usr/bin/env python3\r\n\"\"\"\r\nROS 2 Service Client Example\r\n==============================\r\nThis node calls a service and processes the response.\r\nThink of it as triggering a reflex and observing the result.\r\n\"\"\"\r\n\r\nimport sys\r\nimport rclpy\r\nfrom rclpy.node import Node\r\nfrom example_interfaces.srv import AddTwoInts\r\n\r\n\r\nclass ServiceClient(Node):\r\n    \"\"\"\r\n    A ROS 2 service client node.\r\n\r\n    Calls 'calculate_joint_position' service and handles responses.\r\n    \"\"\"\r\n\r\n    def __init__(self):\r\n        super().__init__('service_client')\r\n\r\n        # Create a client for the service\r\n        self.client = self.create_client(\r\n            AddTwoInts,                  # Service type\r\n            'calculate_joint_position'   # Service name\r\n        )\r\n\r\n        # Wait for the service to be available\r\n        self.get_logger().info('Waiting for service to become available...')\r\n\r\n        while not self.client.wait_for_service(timeout_sec=1.0):\r\n            self.get_logger().warn('Service not available, waiting...')\r\n\r\n        self.get_logger().info('Service is available!')\r\n\r\n    def send_request(self, a, b):\r\n        \"\"\"Send a request and wait for the response.\"\"\"\r\n        request = AddTwoInts.Request()\r\n        request.a = a\r\n        request.b = b\r\n\r\n        self.get_logger().info(f'Sending request: {a} + {b}')\r\n\r\n        # Send request asynchronously\r\n        future = self.client.call_async(request)\r\n\r\n        # Wait for response\r\n        rclpy.spin_until_future_complete(self, future)\r\n\r\n        return future.result()\r\n\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    service_client = ServiceClient()\r\n\r\n    try:\r\n        # Send a test request\r\n        value_a = 10\r\n        value_b = 5\r\n\r\n        if len(sys.argv) >= 3:\r\n            value_a = int(sys.argv[1])\r\n            value_b = int(sys.argv[2])\r\n\r\n        response = service_client.send_request(value_a, value_b)\r\n\r\n        service_client.get_logger().info(\r\n            f'Result: {value_a} + {value_b} = {response.sum}'\r\n        )\r\n\r\n    except KeyboardInterrupt:\r\n        service_client.get_logger().info('Interrupted by user')\r\n    finally:\r\n        service_client.destroy_node()\r\n        rclpy.shutdown()\r\n\r\n\r\nif __name__ == '__main__':\r\n    main()\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Key points:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"wait_for_service()"})})," blocks until the server is ready\u2014essential for reliability"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"call_async()"})})," sends the request and returns a Future"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"spin_until_future_complete()"})})," blocks until the response arrives"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"running-server-and-client-together",children:"Running Server and Client Together"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Terminal 1: Start the service server\r\npython3 simple_service.py\r\n\r\n# Terminal 2: Call the service\r\npython3 service_client.py 15 7\r\n# Output: Result: 15 + 7 = 22\n"})}),"\n",(0,i.jsx)(n.p,{children:"You can also test services from the command line:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'ros2 service call /calculate_joint_position example_interfaces/srv/AddTwoInts "{a: 10, b: 5}"\n'})}),"\n",(0,i.jsx)(n.h2,{id:"complete-working-example",children:"Complete Working Example"}),"\n",(0,i.jsx)(n.p,{children:"Let's combine everything into a realistic robot status monitoring system. This example shows how publishers, subscribers, and services work together."}),"\n",(0,i.jsx)(n.h3,{id:"system-architecture",children:"System Architecture"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     /robot_status      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\r\n\u2502   Status Publisher  \u2502 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502   Status Monitor    \u2502\r\n\u2502   (publishes state) \u2502                        \u2502 (logs all updates)  \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                        \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\n                                                         \u2502\r\n                                                         \u2502 calls\r\n                                                         \u25bc\r\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                        \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\r\n\u2502  Emergency Stop     \u2502\u25c0\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2502  /emergency_stop    \u2502\r\n\u2502  Service Server     \u2502       [SERVICE]        \u2502  (safety override)  \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                        \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,i.jsx)(n.h3,{id:"integrated-node-example",children:"Integrated Node Example"}),"\n",(0,i.jsx)(n.p,{children:"Here's a node that combines publishing, subscribing, and services:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'#!/usr/bin/env python3\r\n"""\r\nIntegrated Robot Controller Example\r\n=====================================\r\nDemonstrates combining topics and services in a single node.\r\n"""\r\n\r\nimport rclpy\r\nfrom rclpy.node import Node\r\nfrom std_msgs.msg import String, Bool\r\nfrom std_srvs.srv import SetBool\r\n\r\n\r\nclass RobotController(Node):\r\n    """\r\n    A robot controller that:\r\n    - Publishes status updates (topic)\r\n    - Subscribes to emergency commands (topic)\r\n    - Provides an enable/disable service\r\n    """\r\n\r\n    def __init__(self):\r\n        super().__init__(\'robot_controller\')\r\n\r\n        # State\r\n        self.enabled = True\r\n        self.status_count = 0\r\n\r\n        # Publisher: Send status updates\r\n        self.status_pub = self.create_publisher(String, \'robot_status\', 10)\r\n\r\n        # Subscriber: Listen for emergency stops\r\n        self.emergency_sub = self.create_subscription(\r\n            Bool, \'emergency_stop\', self.emergency_callback, 10\r\n        )\r\n\r\n        # Service: Enable/disable the robot\r\n        self.enable_srv = self.create_service(\r\n            SetBool, \'set_robot_enabled\', self.enable_callback\r\n        )\r\n\r\n        # Timer: Publish status every second\r\n        self.timer = self.create_timer(1.0, self.publish_status)\r\n\r\n        self.get_logger().info(\'RobotController initialized\')\r\n\r\n    def publish_status(self):\r\n        """Publish current robot status."""\r\n        msg = String()\r\n        status = "ENABLED" if self.enabled else "DISABLED"\r\n        msg.data = f\'[{self.status_count}] Robot status: {status}\'\r\n\r\n        self.status_pub.publish(msg)\r\n        self.status_count += 1\r\n\r\n    def emergency_callback(self, msg):\r\n        """Handle emergency stop signals."""\r\n        if msg.data:  # True = emergency stop triggered\r\n            self.enabled = False\r\n            self.get_logger().warn(\'EMERGENCY STOP RECEIVED!\')\r\n\r\n    def enable_callback(self, request, response):\r\n        """Handle enable/disable service requests."""\r\n        self.enabled = request.data\r\n        response.success = True\r\n        response.message = f\'Robot {"enabled" if self.enabled else "disabled"}\'\r\n\r\n        self.get_logger().info(response.message)\r\n        return response\r\n\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    controller = RobotController()\r\n\r\n    try:\r\n        rclpy.spin(controller)\r\n    except KeyboardInterrupt:\r\n        pass\r\n    finally:\r\n        controller.destroy_node()\r\n        rclpy.shutdown()\r\n\r\n\r\nif __name__ == \'__main__\':\r\n    main()\n'})}),"\n",(0,i.jsx)(n.h3,{id:"testing-the-integrated-system",children:"Testing the Integrated System"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'# Terminal 1: Run the controller\r\npython3 robot_controller.py\r\n\r\n# Terminal 2: Monitor status\r\nros2 topic echo /robot_status\r\n\r\n# Terminal 3: Disable the robot via service\r\nros2 service call /set_robot_enabled std_srvs/srv/SetBool "{data: false}"\r\n\r\n# Terminal 4: Trigger emergency stop via topic\r\nros2 topic pub --once /emergency_stop std_msgs/msg/Bool "{data: true}"\n'})}),"\n",(0,i.jsx)(n.p,{children:"This pattern\u2014combining topics for streaming data with services for commands\u2014is fundamental to real robot systems."}),"\n",(0,i.jsx)(n.admonition,{title:"Design Pattern",type:"info",children:(0,i.jsx)(n.p,{children:"Use topics for continuous data (sensor streams, status updates) and services for discrete commands (enable/disable, calibrate, reset). This matches how the nervous system separates continuous sensory flow from triggered reflexes."})}),"\n",(0,i.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,i.jsx)(n.p,{children:"In this chapter, you learned to write Python code that interfaces with ROS 2:"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Key Concepts:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"rclpy"})," is the Python client library for ROS 2"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Initialize with ",(0,i.jsx)(n.code,{children:"rclpy.init()"}),", run with ",(0,i.jsx)(n.code,{children:"rclpy.spin()"}),", clean up with ",(0,i.jsx)(n.code,{children:"rclpy.shutdown()"})]}),"\n",(0,i.jsxs)(n.li,{children:["Subclass ",(0,i.jsx)(n.code,{children:"Node"})," to create your own nodes"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Publishers"})," send messages to topics"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Use ",(0,i.jsx)(n.code,{children:"create_publisher(msg_type, topic_name, queue_size)"})]}),"\n",(0,i.jsxs)(n.li,{children:["Call ",(0,i.jsx)(n.code,{children:"publish(msg)"})," to send messages"]}),"\n",(0,i.jsx)(n.li,{children:"Typically driven by timers for periodic updates"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Subscribers"})," receive messages from topics"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Use ",(0,i.jsx)(n.code,{children:"create_subscription(msg_type, topic_name, callback, queue_size)"})]}),"\n",(0,i.jsx)(n.li,{children:"Callback is called automatically when messages arrive"}),"\n",(0,i.jsx)(n.li,{children:"No polling needed\u2014ROS 2 handles message delivery"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Service Servers"})," handle requests and return responses"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Use ",(0,i.jsx)(n.code,{children:"create_service(srv_type, service_name, callback)"})]}),"\n",(0,i.jsx)(n.li,{children:"Callback receives request, fills response, and returns it"}),"\n",(0,i.jsx)(n.li,{children:"Must return the response object"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Service Clients"})," send requests and receive responses"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Use ",(0,i.jsx)(n.code,{children:"create_client(srv_type, service_name)"})]}),"\n",(0,i.jsxs)(n.li,{children:["Always ",(0,i.jsx)(n.code,{children:"wait_for_service()"})," before calling"]}),"\n",(0,i.jsxs)(n.li,{children:["Use ",(0,i.jsx)(n.code,{children:"call_async()"})," and ",(0,i.jsx)(n.code,{children:"spin_until_future_complete()"})," for synchronous calls"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Nervous System Parallels:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Publishers = Sensory neurons sending signals"}),"\n",(0,i.jsx)(n.li,{children:"Subscribers = Motor neurons receiving commands"}),"\n",(0,i.jsx)(n.li,{children:"Services = Reflex arcs with guaranteed responses"}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"rclpy.spin()"})," = Staying conscious and responsive"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"What's Next:"})}),"\n",(0,i.jsx)(n.p,{children:"Now that you can write Python code to control ROS 2 nodes, you're ready to describe robot structure. In Chapter 4, we'll explore URDF (Unified Robot Description Format)\u2014how humanoid robots define their physical bodies in software."}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.admonition,{title:"Next Chapter",type:"tip",children:(0,i.jsxs)(n.p,{children:["Continue to ",(0,i.jsx)(n.a,{href:"./urdf-humanoid-robots",children:"Chapter 4: Understanding URDF"})," to learn how robot bodies are described in software."]})})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>l,x:()=>o});var s=r(6540);const i={},t=s.createContext(i);function l(e){const n=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:l(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);